<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-operations/deployment">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="alternate" type="application/rss+xml" href="/yield-docs/blog/rss.xml" title="Yield Protocol RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/yield-docs/blog/atom.xml" title="Yield Protocol Atom Feed"><title data-rh="true">Deployment | Yield Protocol</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://iamsahu.github.io/yield-docs/operations/deployment"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deployment | Yield Protocol"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/yield-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://iamsahu.github.io/yield-docs/operations/deployment"><link data-rh="true" rel="alternate" href="https://iamsahu.github.io/yield-docs/operations/deployment" hreflang="en"><link data-rh="true" rel="alternate" href="https://iamsahu.github.io/yield-docs/operations/deployment" hreflang="x-default"><link rel="stylesheet" href="/yield-docs/assets/css/styles.05417fc2.css">
<link rel="preload" href="/yield-docs/assets/js/runtime~main.63152b99.js" as="script">
<link rel="preload" href="/yield-docs/assets/js/main.b74bad32.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/yield-docs/"><div class="navbar__logo"><img src="/yield-docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/yield-docs/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">YieldProtocol</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/yield-docs/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yieldprotocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yield-docs/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/yield-docs/developers/">Developer Documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer Documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/yield-docs/governance/">Governance</a><button aria-label="Toggle the collapsible sidebar category &#x27;Governance&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/yield-docs/operations/code_reviews">operations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yield-docs/operations/code_reviews">The &quot;Yieldcurity&quot; Standard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/yield-docs/operations/deployment">Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yield-docs/operations/emergency_plans">emergency_plans</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yield-docs/operations/emergency_procedure">Emergency Procedures for Yield Protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/yield-docs/operations/support_procedure">Support Procedure for Yield Protocol</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/yield-docs/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/yield-docs/users/">User Documentation</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Documentation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/yield-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">operations</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Deployment</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Deployment</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>This guide is valid for the 11.6 deployment of Yield v2 (commit f5f0cb6).</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;@yield-protocol/strategy-v2&quot;: &quot;^0.11.0-rc3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;@yield-protocol/utils-v2&quot;: &quot;^2.4.6&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;@yield-protocol/vault-interfaces&quot;: &quot;^2.3.0-rc6&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;@yield-protocol/vault-v2&quot;: &quot;^0.11.0-rc7&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;@yield-protocol/yieldspace-interfaces&quot;: &quot;^2.3.0-rc6&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;@yield-protocol/yieldspace-v2&quot;: &quot;^0.11.0-rc4&quot;,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The deployment steps are numbered sequentially.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">​</a></h2><p>For a protocol deployment, these are the parameters that need to be defined.</p><ul><li>Governor</li><li>Operations team</li><li>Timelock delay</li><li>Assets and assetIds</li><li>Bases</li><li>Ilks for each base, with collateralization ratio and limits for each pair</li><li>For each Ilk: initial offer and duration for the witch</li><li>Series, with seriesId, base, maturity, ilks, name and symbol</li><li>Name and symbol for each pool</li><li>Assets to initialize each pool</li><li>Strategies to deploy, with name and symbol, starting pool and next pool</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mocks">Mocks<a class="hash-link" href="#mocks" title="Direct link to heading">​</a></h2><p>Often, the operations will involve the addresses of external contracts. On testnet, we use mocks to substitute for external contracts. These won’t be needed on mainnet.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="assets-and-oracle-sources">Assets and Oracle Sources<a class="hash-link" href="#assets-and-oracle-sources" title="Direct link to heading">​</a></h3><p>For testing purposes we use a series of mock assets and oracle sources. </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan mocks/01_mocks.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Output</strong>: assets.json, chiSources.json, rateSources.json, spotSources.json</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="core">Core<a class="hash-link" href="#core" title="Direct link to heading">​</a></h2><p>These steps are executed only once in the life of Yield v2. If they need to be executed again that is considered a <strong>major</strong> change subject to the maximum scrutiny.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="libraries">Libraries<a class="hash-link" href="#libraries" title="Direct link to heading">​</a></h3><p>There are three external libraries used in the Yield v2 protocol (SafeERC20Namer, YieldMath, and PoolExtensions). They are not orchestrated or permissioned, and store no data. They should never need to be redeployed. This script also deploys PoolExtensionsWrapper.sol.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan core/10_libraries.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="timelock">Timelock<a class="hash-link" href="#timelock" title="Direct link to heading">​</a></h3><p>During operations the Timelock will allow users to know in advance of any changes to the protocol. During deployment it will allow us to bundle transactions.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan core/11_timelock.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Timelock is deployed with no delay and with all the roles granted to the deployer. This initial configuration makes it work as a transaction relayer. Before the protocol is live, the roles and delay will be adjusted so that the Timelock assumes its intended function.</p><p><strong>Input</strong>: governance.json</p><p><strong>Output</strong>: governance.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="relay">Relay<a class="hash-link" href="#relay" title="Direct link to heading">​</a></h3><p>To ease operations in testnets, a Relay is deployed that has governance permissions over Timelock. Owning the Relay means being able to propose, approve and execute Timelock proposals in a single transaction. Do not use on mainnet.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan mocks/02_relay.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Input</strong>: governance.json</p><p><strong>Output</strong>: governance.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cloak">Cloak<a class="hash-link" href="#cloak" title="Direct link to heading">​</a></h3><p>The Cloak stores the orchestration permissions between contracts, in a way that it will be safe to isolate contracts from the rest of the protocol in an emergency.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan core/12_cloak.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All contracts that inherit from AccessControl must give ROOT access to the Cloak, so that the latter can edit the access control permissions.</p><p><strong>Input</strong>: governance.json</p><p><strong>Output</strong>: governance.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="oracles">Oracles<a class="hash-link" href="#oracles" title="Direct link to heading">​</a></h3><p>To reduce the number of IOracle contracts deployed we use MultiOracles that allow to access several data sources of the same type for a single contract.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan core/13_oracles.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The oracles deployed are:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   chainlinkOracle: ChainlinkMultiOracle,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   compoundOracle: CompoundMultiOracle,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   compositeOracle: CompositeMultiOracle,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   cTokenOracle: CTokenMultiOracle,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   uniswapOracle: UniswapV3Oracle,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Timelock and the Cloak get ROOT permission on these contracts, while the deployer gets his permissions removed. The Timelock gets access to all the governance functions in these contracts.</p><p><strong>Input</strong>: governance.json, protocol.json</p><p><strong>Output</strong>: protocol.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="factories">Factories<a class="hash-link" href="#factories" title="Direct link to heading">​</a></h3><p>We use the Wand to ensure that adding assets and series to the protocol is a robust process. To allow the Wand to deploy Join, FYToken and Pool contracts, and stay within the Spurious Dragon 24Kb contract size limit, we use factories.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan core/13_factories.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The factories deployed are:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   poolFactory: PoolFactory,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   joinFactory: JoinFactory,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   fyTokenFactory: FYTokenFactory,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Timelock and the Cloak get ROOT permission on these contracts, while the deployer gets his permissions removed. The Timelock gets access to all the governance functions in these contracts.</p><p>To deploy the factories, the libraries need to have been deployed first.</p><p><strong>Input</strong>: governance.json, protocol.json</p><p><strong>Output</strong>: protocol.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cauldron">Cauldron<a class="hash-link" href="#cauldron" title="Direct link to heading">​</a></h3><p>The Cauldron is the accounting contract for the Yield v2 Protocol.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan core/14_cauldron.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Timelock and the Cloak get ROOT permission on the Cauldron, while the deployer gets his permissions removed. The Timelock gets access to all the governance functions in the Cauldron.</p><p><strong>Input</strong>: governance.json, protocol.json</p><p><strong>Output</strong>: protocol.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ladle">Ladle<a class="hash-link" href="#ladle" title="Direct link to heading">​</a></h3><p>The Ladle is the routing contract for the Yield v2 Protocol.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan core/15_ladle.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Timelock and the Cloak get ROOT permission on the Ladle, while the deployer gets his permissions removed. The Timelock gets access to all the governance functions in the Ladle.</p><p>The Ladle gets permission to use several permissioned functions in the Cauldron. A plan is stored in the Cloak to pause or remove those permissions in an emergency.</p><p>To deploy the Ladle, the Cauldron needs to have been deployed first.</p><p><strong>Input</strong>: governance.json, protocol.json</p><p><strong>Output</strong>: protocol.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="witch">Witch<a class="hash-link" href="#witch" title="Direct link to heading">​</a></h3><p>The Witch is the liquidations contract for the Yield v2 Protocol.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan core/16_Witch.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Timelock and the Cloak get ROOT permission on the Witch, while the deployer gets his permissions removed. The Timelock gets access to all the governance functions in the Witch.</p><p>The Witch gets permission to use several permissioned functions in the Cauldron. A plan is stored in the Cloak to pause or remove those permissions in an emergency.</p><p>To deploy the Witch, the Ladle (and therefore Cauldron) needs to have been deployed first.</p><p><strong>Input</strong>: governance.json, protocol.json</p><p><strong>Output</strong>: protocol.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="wand">Wand<a class="hash-link" href="#wand" title="Direct link to heading">​</a></h3><p>The Wand is a helper contract to add assets and series to the Yield v2 Protocol. While its use is not strictly necessary, it is recommended to avoid mistakes on these operations.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan core/17_Wand.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Timelock and the Cloak get ROOT permission on the Wand, while the deployer gets his permissions removed. The Timelock gets access to all the governance functions in the Wand.</p><p>The Wand gets permission to use several permissioned functions in the Cauldron, Ladle, Witch and Factories. A plan is stored in the Cloak to pause or remove those permissions in an emergency.</p><p>To deploy the Wand, the Cauldron, Ladle, Witch and Factories need to have been deployed first.</p><p>To execute the <code>makeBase</code> function, appropriate <code>chi</code> and <code>rate</code> data sources need to have been set in an oracle.</p><p>To execute the <code>makeIlk</code> function, appropriate <code>spot</code> data sources need to have been set in an oracle, and the collateral must have been enabled for liquidations in the Witch with <code>setIlk</code>.</p><p>To execute the <code>addSeries</code> function, <code>makeBase</code> needs to have been executed first for the chosen underlying.</p><p><strong>Input</strong>: governance.json, protocol.json</p><p><strong>Output</strong>: protocol.json</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="operations">Operations<a class="hash-link" href="#operations" title="Direct link to heading">​</a></h2><p>The operations are expected to be repeatedly executed during the lifetime of Yield v2. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="chi-sources">Chi Sources<a class="hash-link" href="#chi-sources" title="Direct link to heading">​</a></h3><p>The Chi Sources produce data for fyToken redemption, and need to be present before an asset can be made into a base. Currently we only support Compound cTokens as a source of Chi.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/20_updateChiSource.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside the bytes6 identifiers and addresses of the cTokens to use.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> const newSources: Array&lt;[string, string]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI,  &quot;0xD9D6D61bc216a0BE1EecA4155b258CbB3030d23f&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, &quot;0x078FfF3582342a16a7b038E6F4Fc9E88F738143d&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, &quot;0x1292BAe0Ba398F9e480251b8C40D2A171EC446D1&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // [stringToBytes6(&#x27;TST3&#x27;), &quot;0x8A93d247134d91e0de6f96547cB0204e5BE8e5D8&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The sources are set in the compoundOracle from protocol.json, as an assetId/CHI pair.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">proposal.push({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target: compoundOracle.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data: compoundOracle.interface.encodeFunctionData(&quot;setSource&quot;, [baseId, CHI, sourceAddress])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script reads the current chiSources.json to update it with the new sources. If there are no current sources an empty json Map must be provided in chiSources.json.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;dataType&quot;:&quot;Map&quot;,&quot;value&quot;:[]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Input</strong>: governance.json, protocol.json, chiSources.json (for updating)</p><p><strong>Output</strong>: chiSources.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rate-sources">Rate Sources<a class="hash-link" href="#rate-sources" title="Direct link to heading">​</a></h3><p>The Rate Sources produce data for debt accrual after maturity, and need to be present before an asset can be made into a base. Currently we only support Compound cTokens as a source of Rate.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/21_updateRateSource.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside the bytes6 identifiers and addresses of the cTokens to use.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> const newSources: Array&lt;[string, string]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI,  &quot;0x78F3579FbBb4a9894cE27cC201216Ef46A132f1c&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, &quot;0x625E23f0C081CF8a2bbb87738087D8b0A5f5F412&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, &quot;0xBce93F0D091092D780C6A386fb6d34780FFb031C&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // [stringToBytes6(&#x27;TST3&#x27;), &quot;0x8A93d247134d91e0de6f96547cB0204e5BE8e5D8&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The sources are set in the compoundOracle from protocol.json, as an assetId/RATE pair.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">proposal.push({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target: compoundOracle.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data: compoundOracle.interface.encodeFunctionData(&quot;setSource&quot;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    baseId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RATE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sourceAddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script reads the current rateSources.json to update it with the new sources. If there are no current sources an empty json Map must be provided in rateSources.json.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;dataType&quot;:&quot;Map&quot;,&quot;value&quot;:[]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Input</strong>: governance.json, protocol.json, rateSources.json (for updating)</p><p><strong>Output</strong>: rateSources.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="spot-sources">Spot Sources<a class="hash-link" href="#spot-sources" title="Direct link to heading">​</a></h3><p>The Spot Sources produce data for vault collateralization checks, and need to be present before an asset can be made into a ilk. Currently we support Chainlink aggregators as a source of Spot.</p><p>When setting up a source, the reverse is also set. The ChainlinkMultiOracle will also always return the input amount as the output amount when a base is the same as the quote.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/22_updateSpotSource.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside the bytes6 identifiers of base and quote, the string identifier for the appropriate MultiOracle in protocol.json, and addresses of the aggregators to use.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> const newSources: Array&lt;[string, string, string, string]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI, ETH,   &#x27;chainlinkOracle&#x27;, &quot;0x22B58f1EbEDfCA50feF632bD73368b2FdA96D541&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, ETH,  &#x27;chainlinkOracle&#x27;, &quot;0x64EaC61A2DFda2c3Fa04eED49AA33D021AeC8838&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, ETH,  &#x27;chainlinkOracle&#x27;, &quot;0x0bF499444525a23E7Bb61997539725cA2e928138&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [WBTC, ETH,  &#x27;chainlinkOracle&#x27;, &quot;0xF7904a295A029a3aBDFFB6F12755974a958C7C25&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The sources are set in the specified IOracle from protocol.json, as an baseId/quoteId pair.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">proposal.push({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target: oracle.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data: oracle.interface.encodeFunctionData(&quot;setSource&quot;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    baseId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quoteId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sourceAddress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script reads the current spotSources.json to update it with the new sources. If there are no current sources an empty json Map must be provided in spotSources.json.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;dataType&quot;:&quot;Map&quot;,&quot;value&quot;:[]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Input</strong>: governance.json, protocol.json, spotSources.json (for updating)</p><p><strong>Output</strong>: spotSources.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ctoken-sources">CToken Sources<a class="hash-link" href="#ctoken-sources" title="Direct link to heading">​</a></h3><p>The cToken Sources produce spot data to use cToken as collateral, and need to be present before an cToken can be made into an ilk.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/23_updateCTokenSource.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside the bytes6 identifiers of the cToken and its underlying, the string identifier for the CTokenMultiOracle, and addresses of the cTokens to use.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> const newSources: Array&lt;[string, string, string, string]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [CDAI, DAI, &#x27;cTokenOracle&#x27;,   &quot;0xf0d0eb522cfa50b716b3b1604c4f0fa6f04376ad&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [CUSDC, USDC, &#x27;cTokenOracle&#x27;, &quot;0x4a92e71227d294f041bd82dd8f78591b75140d63&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [CUSDT, USDT, &#x27;cTokenOracle&#x27;, &quot;0x3f0a0ea2f86bae6362cf9799b523ba06647da018&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The sources are set in the compoundOracle from protocol.json, as an assetId/CHI pair.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">proposal.push({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target: cTokenOracle.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data: cTokenOracle.interface.encodeFunctionData(&quot;setSource&quot;, [baseId, quoteId, sourceAddress])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script reads the current cTokenSources.json to update it with the new sources. If there are no current sources an empty json Map must be provided in cTokenSources.json.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;dataType&quot;:&quot;Map&quot;,&quot;value&quot;:[]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Input</strong>: governance.json, protocol.json, cTokenSources.json (for updating)</p><p><strong>Output</strong>: cTokenSources.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="composite-pairs">Composite Pairs<a class="hash-link" href="#composite-pairs" title="Direct link to heading">​</a></h3><p>When there isn’t an available source of Spot for a given token pair, we will combine several IOracle Spot feeds using a CompositeMultiOracle. First we must configure the CompositeMultiOracle with the available Spot sources. There is no current use for the CompositeMultiOracle.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/24_updateCompositePairs.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside the bytes6 identifiers of base and quote, and the string identifier for the appropriate IOracle in protocol.json.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> const newCompositePairs: Array&lt;[string, string, string]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   /*[DAI, ETH, &#x27;chainlinkOracle&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, ETH, &#x27;chainlinkOracle&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, ETH, &#x27;chainlinkOracle&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [WBTC, ETH, &#x27;chainlinkOracle&#x27;],*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The sources are set in the specified IOracle from protocol.json, as an baseId/quoteId pair.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">proposal.push({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target: compositeOracle.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data: compositeOracle.interface.encodeFunctionData(&quot;setSource&quot;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    baseId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quoteId, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol.get(oracleName) as string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Input</strong>: governance.json, protocol.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="composite-paths">Composite Paths<a class="hash-link" href="#composite-paths" title="Direct link to heading">​</a></h3><p>When there isn’t an available source of Spot for a given token pair, we will combine several IOracle Spot feeds using a CompositeMultiOracle. Now we must configure the CompositeMultiOracle with the appropriate paths between the Pairs that were added in the previous step. There is no current use for the CompositeMultiOracle.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/25_updateCompositePaths.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside the bytes6 identifiers of base and quote, and an array with the bytes6 identifiers of the intermediate steps. For example <code>[DAI, USDC, [ETH]]</code> means that to calculate the DAI/USDC price we will combine the DAI/ETH and the ETH/USDC prices.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> const newCompositePaths: Array&lt;[string, string, Array&lt;string&gt;]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   /* [DAI, USDC, [ETH]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI, USDT, [ETH]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI, WBTC, [ETH]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, DAI, [ETH]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, USDT, [ETH]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, WBTC, [ETH]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, DAI, [ETH]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, USDC, [ETH]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, WBTC, [ETH]] */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The paths are set in the specified CompositeMultiOracle from protocol.json, enabling a baseId/quoteId pair.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">proposal.push({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target: compositeOracle.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data: compositeOracle.interface.encodeFunctionData(&quot;setPath&quot;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    baseId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quoteId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Input</strong>: governance.json, protocol.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-assets">Add Assets<a class="hash-link" href="#add-assets" title="Direct link to heading">​</a></h3><p>Adding assets makes them known to the Yield v2 core contracts using the Wand, and deploys a Join for them, but doesn’t set them up as collateral or underlying yet. This is a prerequisite to any other steps involving assets.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/30_addAsset.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside the bytes6 identifiers and addresses of the assets to use.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> const newAssets: Array&lt;[string, string]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI,  &quot;0xaFCdc724EB8781Ee721863db1B15939675996484&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, &quot;0xeaCB3AAB4CA68F1e6f38D56bC5FCc499B76B4e2D&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [ETH,  &quot;0x55C0458edF1D8E07DF9FB44B8960AecC515B4492&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [TST,  &quot;0x51C9B30BE0417559A467D1f65d710a73E5845B3a&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [WBTC, &quot;0xD5FafCE68897bdb55fA11Dd77858Df7a9a458D92&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, &quot;0x233551369dc535f5fF3517c28fDCce81d650063e&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [CDAI,  &quot;0xf0d0eb522cfa50b716b3b1604c4f0fa6f04376ad&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [CUSDC, &quot;0x4a92e71227d294f041bd82dd8f78591b75140d63&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [CUSDT, &quot;0x3f0a0ea2f86bae6362cf9799b523ba06647da018&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // [stringToBytes6(&#x27;TST3&#x27;), &quot;0xfaAddC93baf78e89DCf37bA67943E1bE8F37Bb8c&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script reads the current joins.json to update it with the new contracts. If there are no current Join contracts an empty json Map must be provided in joins.json.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;dataType&quot;:&quot;Map&quot;,&quot;value&quot;:[]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As part of the Join deployment process, the Wand obtains ROOT permissions on the Join, and gives the same role to the deployer (in this case, the Timelock). It also gives <code>JOIN</code> and <code>EXIT</code> permissions to the Ladle.</p><p>The Timelock obtains permission to use the governance functions in the deployed Joins. A plan is stored in the Cloak to isolate the new Join from the Ladle in an emergency.</p><p><strong>Input</strong>: governance.json, protocol.json, assets.json, joins.json (for updating)</p><p><strong>Output</strong>: joins.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="make-bases">Make Bases<a class="hash-link" href="#make-bases" title="Direct link to heading">​</a></h3><p>Making an asset into a base allows using it as an underlying for series and pools in Yield v2. This is done using the Wand, and is a prerequisite to use the asset as a base in a series.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/31_makeBase.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside the bytes6 identifiers of the assets to make into bases, as well as the string identifier in protocol.json of the IOracle with the assetId/RATE pair.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> const newBases: Array&lt;[string, string]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI,  &#x27;compoundOracle&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, &#x27;compoundOracle&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, &#x27;compoundOracle&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   // [stringToBytes6(&#x27;TST3&#x27;), &#x27;compoundOracle&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script verifies that the Chi and Rate sources for the assets supplied are present in the IOracle specified.</p><p>As part of this process, the Wand gives <code>JOIN</code> permissions to the Witch. A plan is stored in the Cloak to remove this permission in an emergency.</p><p><strong>Input</strong>: governance.json, protocol.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="make-ilks">Make Ilks<a class="hash-link" href="#make-ilks" title="Direct link to heading">​</a></h3><p>Making an asset into an ilk for a given base allows using it as an collateral for vaults of corresponding series in Yield v2. This is done using the Wand.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/32_makeIlk.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside:</p><ul><li>An existing base (bytes6 identifier)</li></ul><ul><li>The asset to make into an ilk for the base (bytes6 identifier)</li></ul><ul><li>The string identifier in protocol.json of the IOracle with the baseId/ilkId pair. This can currently be the chainlinkOracle or the compositeOracle.</li></ul><ul><li>The collateralization ratio, with 6 decimal places. 1500000 = 150%.</li></ul><ul><li>The reverse of the collateralization ratio, with 6 decimal places. 666666 = 66%.</li></ul><ul><li>The debt ceiling for the base/ilk pair, with some zeros added afterwards.</li></ul><ul><li>The dust level for the base/ilk pair, with some zeros added afterwards.</li></ul><ul><li>The number of zeros to add to the debt ceiling and dust level. Note this needs to be the decimals of the base in the base/ilk pair.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> // Input data: baseId, ilkId, oracle, ratio (1000000 == 100%), inv(ratio), line, dust, dec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> const newIlks: Array&lt;[string, string, string, number, number, number, number, number]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI, ETH, CHAINLINK, 1400000, 714000, 100000, 1, 18],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI, DAI, CHAINLINK, 1000000, 1000000, 10000000, 0, 18], // Constant 1, no dust</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI, USDC, CHAINLINK, 1330000, 751000, 100000, 1, 18], // Via ETH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [DAI, WBTC, CHAINLINK, 1500000, 666000, 100000, 1, 18], // Via ETH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    [DAI, USDT, CHAINLINK, 1000000, 100000, 1, 18], // Via ETH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, ETH, CHAINLINK, 1400000, 714000, 100000, 1, 6],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, DAI, CHAINLINK, 1330000, 751000, 100000, 1, 6], // Via ETH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, USDC, CHAINLINK, 1000000, 1000000, 10000000, 0, 6], // Constant 1, no dust</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDC, WBTC, CHAINLINK, 1500000, 666000, 100000, 1, 6], // Via ETH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    [USDC, USDT, CHAINLINK, 1000000, 100000, 1, 6], // Via ETH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*    [USDT, USDT, CHAINLINK, 1000000, 100000, 0, 18], // Constant 1, no dust</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, DAI, CHAINLINK, 1000000, 100000, 1, 18], // Via ETH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, USDC, CHAINLINK, 1000000, 100000, 1, 18], // Via ETH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, ETH, CHAINLINK, 1000000, 100000, 1, 18],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [USDT, WBTC, CHAINLINK, 1000000, 100000, 1, 18], // Via ETH */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    [DAI, CDAI, CTOKEN, 1000000, 1000000, 1, 18],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    [USDC, CUSDC, CTOKEN, 1000000, 1000000, 1, 6],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    [USDT, CUSDT, CTOKEN, 1000000, 1000000, 1, 18],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script verifies that the Spot sources for the pairs supplied are present in the IOracle specified.</p><p>The ilk is enabled in the Witch for liquidations, with the same <code>line</code>, <code>dust</code> and <code>dec</code> parameters as in the Cauldron.</p><p>As part of this process, the Wand gives <code>EXIT</code> permissions to the Witch.  A plan is stored in the Cloak to remove this permission in an emergency. </p><p><strong>Input</strong>: governance.json, protocol.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-series">Add Series<a class="hash-link" href="#add-series" title="Direct link to heading">​</a></h3><p>Adding a series is a complex process that deploys a fyToken and a Pool contracts. This is done using the Wand.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/33_addSeries.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside the bytes6 identifiers of:</p><ul><li>A bytes6 identifier for the series, which gets LP added for the pool symbol.</li></ul><ul><li>The bytes6 identifier of the asset to use as an underlying.</li></ul><ul><li>The maturity of the series, in unix time.</li></ul><ul><li>An array of assets to be used as ilks for the series.</li></ul><ul><li>The name for the fyToken, which gets added “LP Token” for the corresponding pool.</li></ul><ul><li>The symbol for the fyToken, which gets added “LP” for the corresponding pool.</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> const newSeries: Array&lt;[string, string, number, string[], string, string]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [stringToBytes6(&#x27;0104&#x27;), DAI,  EODEC21, [ETH, DAI, USDC, WBTC], &#x27;FYDAI2112&#x27;, &#x27;FYDAI2112&#x27;], // Dec21</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [stringToBytes6(&#x27;0105&#x27;), DAI,  EOMAR22, [ETH, DAI, USDC, WBTC], &#x27;FYDAI2203&#x27;, &#x27;FYDAI2203&#x27;], // Mar22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [stringToBytes6(&#x27;0204&#x27;), USDC, EODEC21, [ETH, DAI, USDC, WBTC], &#x27;FYUSDC2112&#x27;, &#x27;FYUSDC2112&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   [stringToBytes6(&#x27;0205&#x27;), USDC, EOMAR22, [ETH, DAI, USDC, WBTC], &#x27;FYUSDC2203&#x27;, &#x27;FYUSDC2203&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The asset supplied as base needs to have been made into a base, and the ilks supplied need to have been made into ilks for the base supplied.</p><p>The deployment of a series costs about 10M gas, so only one can be done per block. The script uses the Timelock for deployment, but does one proposal per series instead of bundling them as for the rest of the protocol.</p><p>As part of the Join deployment process, the Timelock obtains ROOT permissions on the fyToken. The fyToken contract is also permissioned to <code>EXIT</code> from the Join for its underlying, so that it can be redeemed. The Ladle is permissioned to <code>MINT</code> and <code>BURN</code> fyToken.  A plan is stored in the Cloak to remove these permissions in an emergency.</p><p>The script reads the current fyTokens.json and pools.json to update it with the new contracts. If there are no current FYToken or Pool contracts an empty json Map must be provided in fyTokens.json and pools.json.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{&quot;dataType&quot;:&quot;Map&quot;,&quot;value&quot;:[]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Input</strong>: governance.json, protocol.json, fyTokens.json (for updating), pools.json (for updating)</p><p><strong>Output</strong>: fyTokens.json, pools.json</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pools">Pools<a class="hash-link" href="#pools" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pool-initialization">Pool Initialization<a class="hash-link" href="#pool-initialization" title="Direct link to heading">​</a></h3><p>The initialization of pools can be done by bundling a transaction to transfer underlying to the pool, with a transaction to mint LP tokens. All pools are intialized by having the Timelock transfer an equivalent of $100 to the pool, with the LP tokens sent to the zero address.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/34_initPools.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Input</strong>: governance.json, pools.json</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="strategies">Strategies<a class="hash-link" href="#strategies" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="deployment-1">Deployment<a class="hash-link" href="#deployment-1" title="Direct link to heading">​</a></h3><p>The deployment of liquidity strategies is done with a script, in the same manner as the core protocols were deployed.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan strategies/40_strategies.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The script includes inside the init data: It includes the name and symbol for the strategy, as well as the bytes6 identifier for the base asset that will be common to all pools that the strategy works with.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export const strategiesData: Array&lt;[string, string, string]&gt; = [ // name, symbol, baseId</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     [&#x27;YSDAIQ1&#x27;, &#x27;YSDAIQ1&#x27;, DAI],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     [&#x27;YSDAIQ2&#x27;, &#x27;YSDAIQ2&#x27;, DAI],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     [&#x27;YSUSDCQ1&#x27;, &#x27;YSUSDCQ1&#x27;, USDC],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     [&#x27;YSUSDCQ2&#x27;, &#x27;YSUSDCQ2&#x27;, USDC],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As part of the deployment process, the Timelock is given ROOT permissions to each Strategy, as well as permission to execute all governance actions.</p><p><strong>Input</strong>: governance.json, protocol.json</p><p><strong>Output</strong>: strategies.json</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="initialization">Initialization<a class="hash-link" href="#initialization" title="Direct link to heading">​</a></h3><p>The initialization of strategies involves at least four steps, and is provided to be used in testnets.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npx hardhat run --network kovan operations/41_initStrategies.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The input data includes a string to be used as both name and symbol for the strategy, as well as the bytes6 identifiers for the first series/pool pair, and the next series pool pair. The bytes6 identifiers for a series and the corresponding pool usually match.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const strategiesInit: Array&lt;[string, [string, string], [string, string]]&gt; = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // [strategyId, [startPoolId, startSeriesId],[nextPoolId,nextSeriesId]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&#x27;YSDAIQ1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [stringToBytes6(&#x27;0105&#x27;), stringToBytes6(&#x27;0105&#x27;)],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [stringToBytes6(&#x27;0107&#x27;), stringToBytes6(&#x27;0107&#x27;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&#x27;YSDAIQ2&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [stringToBytes6(&#x27;0104&#x27;), stringToBytes6(&#x27;0104&#x27;)],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [stringToBytes6(&#x27;0106&#x27;), stringToBytes6(&#x27;0106&#x27;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&#x27;YSUSDCQ1&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [stringToBytes6(&#x27;0205&#x27;), stringToBytes6(&#x27;0205&#x27;)],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [stringToBytes6(&#x27;0207&#x27;), stringToBytes6(&#x27;0207&#x27;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [&#x27;YSUSDCQ2&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [stringToBytes6(&#x27;0204&#x27;), stringToBytes6(&#x27;0204&#x27;)],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [stringToBytes6(&#x27;0206&#x27;), stringToBytes6(&#x27;0206&#x27;)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The strategy needs to be supplied with underlying to mint the initial Strategy tokens. We mint the underlying in testnets, but in mainnet it would be done with a transfer from the Timelock.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">proposal.push(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target: base.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data: base.interface.encodeFunctionData(&quot;mint&quot;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      strategy.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      baseUnit.mul(1000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As part of the initialization process, the Strategy is added as an Integration to the Ladle, to allow the Ladle to route calls to the Strategy.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">proposal.push(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target: ladle.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data: ladle.interface.encodeFunctionData(&quot;addIntegration&quot;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      strategy.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As part of the initialization process, the Strategy is added as a Token to the Ladle, to allow the Ladle to transfer and permit Strategy tokens.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">proposal.push(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target: ladle.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data: ladle.interface.encodeFunctionData(&quot;addToken&quot;, [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      strategy.address,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Input</strong>: governance.json, protocol.json, pools.json, strategies.json</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/iamsahu/yield-docs/tree/master/docs/operations/deployment.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/yield-docs/operations/code_reviews"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">The &quot;Yieldcurity&quot; Standard</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/yield-docs/operations/emergency_plans"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">emergency_plans</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#mocks" class="table-of-contents__link toc-highlight">Mocks</a><ul><li><a href="#assets-and-oracle-sources" class="table-of-contents__link toc-highlight">Assets and Oracle Sources</a></li></ul></li><li><a href="#core" class="table-of-contents__link toc-highlight">Core</a><ul><li><a href="#libraries" class="table-of-contents__link toc-highlight">Libraries</a></li><li><a href="#timelock" class="table-of-contents__link toc-highlight">Timelock</a></li><li><a href="#relay" class="table-of-contents__link toc-highlight">Relay</a></li><li><a href="#cloak" class="table-of-contents__link toc-highlight">Cloak</a></li><li><a href="#oracles" class="table-of-contents__link toc-highlight">Oracles</a></li><li><a href="#factories" class="table-of-contents__link toc-highlight">Factories</a></li><li><a href="#cauldron" class="table-of-contents__link toc-highlight">Cauldron</a></li><li><a href="#ladle" class="table-of-contents__link toc-highlight">Ladle</a></li><li><a href="#witch" class="table-of-contents__link toc-highlight">Witch</a></li><li><a href="#wand" class="table-of-contents__link toc-highlight">Wand</a></li></ul></li><li><a href="#operations" class="table-of-contents__link toc-highlight">Operations</a><ul><li><a href="#chi-sources" class="table-of-contents__link toc-highlight">Chi Sources</a></li><li><a href="#rate-sources" class="table-of-contents__link toc-highlight">Rate Sources</a></li><li><a href="#spot-sources" class="table-of-contents__link toc-highlight">Spot Sources</a></li><li><a href="#ctoken-sources" class="table-of-contents__link toc-highlight">CToken Sources</a></li><li><a href="#composite-pairs" class="table-of-contents__link toc-highlight">Composite Pairs</a></li><li><a href="#composite-paths" class="table-of-contents__link toc-highlight">Composite Paths</a></li><li><a href="#add-assets" class="table-of-contents__link toc-highlight">Add Assets</a></li><li><a href="#make-bases" class="table-of-contents__link toc-highlight">Make Bases</a></li><li><a href="#make-ilks" class="table-of-contents__link toc-highlight">Make Ilks</a></li><li><a href="#add-series" class="table-of-contents__link toc-highlight">Add Series</a></li></ul></li><li><a href="#pools" class="table-of-contents__link toc-highlight">Pools</a><ul><li><a href="#pool-initialization" class="table-of-contents__link toc-highlight">Pool Initialization</a></li></ul></li><li><a href="#strategies" class="table-of-contents__link toc-highlight">Strategies</a><ul><li><a href="#deployment-1" class="table-of-contents__link toc-highlight">Deployment</a></li><li><a href="#initialization" class="table-of-contents__link toc-highlight">Initialization</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/JAFfDj5" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/yieldprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/yieldprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 YieldProtocol, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/yield-docs/assets/js/runtime~main.63152b99.js"></script>
<script src="/yield-docs/assets/js/main.b74bad32.js"></script>
</body>
</html>